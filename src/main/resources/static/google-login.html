<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>Obtener Google ID Token - Clinipets</title>
    <script async defer src="https://accounts.google.com/gsi/client"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, sans-serif;
            margin: 2rem;
        }

        .box {
            max-width: 720px;
            margin: 0 auto;
        }

        textarea {
            width: 100%;
            height: 160px;
            font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        }

        .row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 12px 0;
            flex-wrap: wrap;
        }

        .muted {
            color: #666;
            font-size: 0.9rem;
        }


        button {
            padding: .6rem 1rem;
        }

        code {
            background: #f5f5f5;
            padding: 2px 4px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
<div class="box">
    <h1>Obtener Google ID Token</h1>
    <p class="muted">Usa este botón para iniciar sesión y obtener un <strong>ID Token</strong> (JWT) que luego puedes
        enviar a <code>POST /api/auth/google</code>.</p>

    <div class="row" id="g_id_signin"></div>

    <div class="row">
        <button disabled id="copyBtn">Copiar ID Token</button>
        <span class="muted" id="status">Esperando login…</span>
    </div>

    <label class="muted" for="token">token</label>
    <textarea id="token" placeholder="Aquí verás tu ID Token JWT tras iniciar sesión"></textarea>

    <h3>Cómo usarlo</h3>
    <ol>
        <li>Haz clic en “Sign in with Google”.</li>
        <li>Se rellenará el <em>ID Token</em> en el recuadro superior.</li>
        <li>Cópialo y úsalo en tu request a <code>POST /api/auth/google</code>:
            <pre>POST {{host}}/api/auth/google
Content-Type: application/json

{
  "idToken": "&lt;pega_aquí_el_id_token&gt;"
}
</pre>
        </li>
    </ol>

    <p class="muted">Client ID configurado para esta página:</p>
    <p><code id="cid"></code></p>
</div>

<script>
    // Ajusta este valor si cambias el client id en application-default.properties
    const CLIENT_ID = "516859256009-obqnjjbnn9k5e2phvbk35sspf1sdvqr7.apps.googleusercontent.com";

    const cidEl = document.getElementById('cid');
    const tokenEl = document.getElementById('token');
    const statusEl = document.getElementById('status');
    const copyBtn = document.getElementById('copyBtn');
    cidEl.textContent = CLIENT_ID;

    window.handleCredentialResponse = (response) => {
        const idToken = response && response.credential;
        if (idToken) {
            tokenEl.value = idToken;
            statusEl.textContent = 'ID Token recibido';
            statusEl.className = 'ok';
            copyBtn.disabled = false;
        } else {
            statusEl.textContent = 'No se recibió credential';
            statusEl.className = 'err';
        }
    };

    window.onload = () => {
        google.accounts.id.initialize({
            client_id: CLIENT_ID,
            callback: handleCredentialResponse
        });
        google.accounts.id.renderButton(
            document.getElementById('g_id_signin'),
            {theme: 'outline', size: 'large', type: 'standard', shape: 'rectangular'}
        );
    };

    copyBtn.addEventListener('click', async () => {
        try {
            await navigator.clipboard.writeText(tokenEl.value || '');
            statusEl.textContent = 'Copiado al portapapeles';
            statusEl.className = 'ok';
        } catch (e) {
            statusEl.textContent = 'No se pudo copiar';
            statusEl.className = 'err';
        }
    });
</script>
</body>
</html>

